


# Essential Tools

## Documentation

The ability to understand a program using local documentation resources; man, info, /usr/share/doc, within the RPM package.

### man

To browse man pages for a keyword use `-k`, e.g. scan documentation for all things relating to password:

    man -k password

Alternatively:

    mandb
    apropos passwd

Specific sections with man, refer to different topics, e.g. section 5 is about files, so `man 5 passwd` would bring up the documentation on `/etc/passwd`.

### GNU info

    info info

Some keys for driving info:

- `n` next node
- `p` previous node
- `u` parent node
- `t` top node
- `home` `end` `pgup` `pgdn` scroll content
- `l` go back
- `q` quit
- `H` keyboard shortcuts cheatsheet

Searching info:

    $ info --apropos=tee
    "(coreutils)tee invocation" -- tee
    "(libc)Control Functions" -- feupdateenv
    "(gawk)Tee Program" -- 'tee' utility

And then `info gawk tee` for example to pull up the third result.

### /usr/share/doc

A gold mine of documents and sample configuration files. Usually for distributions that are not considered core, and don't offer man or info pages.
### RPM bundled documentation

    $ rpm -qd tmux
    /usr/share/doc/tmux/CHANGES
    /usr/share/doc/tmux/FAQ
    /usr/share/doc/tmux/TODO
    /usr/share/man/man1/tmux.1.gz

### General Searching Techniques

    $ updatedb
    $ locate passwd

    $ which passwd
    /usr/bin/passwd

    $ whatis passwd
    passwd (1)           - update user's authentication tokens
    sslpasswd (1ssl)     - compute password hashes
    passwd (5)           - password file

    $ whereis passwd
    passwd: /usr/bin/passwd /etc/passwd /usr/share/man/man1/passwd.1.gz /usr/share/man/man5/passwd.5.gz


## Finding Files

### locate


### find

    $ find /etc -name motd  #named motd
    $ find /etc -user schnerg  #owned by user shnerg
    $ find / -mtime 3  #modified in last 3 days
    $ find / -mtime +3  #not within the last 3 days

    $ id ben
    uid=1000(ben) gid=1000(ben) groups=1000(ben),1004(finance)
    $ find / -uid 1000  #owned by uid 1000 (ben)
    
    $ find / -user ben -type f  #filter by files
    $ find / -user ben -type f -exec cp {} /home/mary \; #execute a shell command against each result file `{}`




## Redirection

`>` stdout to new file (overwrite if exists)
`>>` stdout to file (appending if exists)
`2>` stderr redirection
`2>&1` stderr to stdout (useful for piping stderr, as pipes only work with stdout)
`|` pipe stdout from one program to stdin of another


## grep

`-v` to inverse (e.g. things not comments `grep -v '^#'`)
`-i` case insensitive
`[^linux]` negate characters, this will match against any characters that are not 'l', 'i', 'n', 'u' or 'x'.
`-E` extended regular expression support

Regular expressions:

- `.` any single character
- `?` one or more
- `*` zero or more

Extended regular expressions can be used with `-E` switch or the `egrep` command.

    grep -E '(a)+' file
    grep 'l...x' file



## Switch Users (su)

A login shell (`.bash_profile`) vs interactive shell (`.bashrc`).

A login shell can be obtained by passed `-` (dash), `-l` or `--login` to the `su` command.

    su - shnerg
    su -l shnerg
    su --login shnerg

`/etc/profile` is the global shell configuration, and applies to all users login shells.



## Archiving and Compression

Creating archives:

    tar -cvf foo.tar directory1 file1 file2
    tar -czvf foo.tar.gz directory1 file1 file2 #with gzip
    tar -cjvf foo.tar.bz directory1 file1 file2 #with bzip

List contents (without extraction):

    tar -tvf foo.tar

Extract them:

    tar -xvf foo.tar
    tar -xzvf foo.tar.gz
    tar -xjvf foo.tar.bz

Diffencing an archives contents with an existing exploded structure:

    $ tar -dzvf dir1-v2.tar.gz 
    directory1/
    directory1/file4
    directory1/wookie4
    tar: directory1/wookie4: Warning: Cannot stat: No such file or directory
    directory1/wookie3
    tar: directory1/wookie3: Warning: Cannot stat: No such file or directory
    directory1/file3
    directory1/imp1
    directory1/imp1: Mod time differs
    directory1/imp1: Size differs
    directory1/imp2
    directory1/file1
    directory1/file2



Compression:

    gzip file1
    gzip -d file1
    bzip file1

Listing compression stats on a compressed file:

    $ gzip -l hello1.gz
             compressed        uncompressed  ratio uncompressed_name
                     83                  62   6.5% hello1

Archiving with `star`.

    star -c -f=foo.tar directory1 hello1 hello2
    star -cz -f=foo.tar.gz directory1 hello1 hello2 #with compression


Listing 

    $ star -t -f=foo.tar
    directory1/
    directory1/file4
    directory1/file3
    directory1/imp1
    directory1/imp2
    directory1/file1
    directory1/file2
    hello1
    hello2

Extract a specific (`hello1`) file from the archive:

    star -x -f=foo.tar hello1



## Hard and Soft Links

Soft links, or symbolic links (symlinks), are simply pointers to other files. Symlinks can span multiple file systems. Permissions on symlinks aren't real. The underlying permissions of the target file is what gets applied. They can easily be created with `ln` like so:

    ln -s /etc/motd ~/motd

Hard links are links to a specific inode on the file system. Due to this coupling, cannot span different file systems. Created with `ln`:

    $ ls -l
    drwxrwxr-x. 2 ben ben 4096 May 13 20:42 directory1
    -rw-rw-r--. 1 ben ben    0 May 13 20:53 hello1
    lrwxrwxrwx. 1 ben ben    9 May 14 17:31 motd -> /etc/motd

    $ ln hello1 hello1-hardlink
    $ ls -l
    drwxrwxr-x. 2 ben ben 4096 May 13 20:42 directory1
    -rw-rw-r--. 2 ben ben    0 May 13 20:53 hello1
    -rw-rw-r--. 2 ben ben    0 May 13 20:53 hello1-hardlink
    lrwxrwxrwx. 1 ben ben    9 May 14 17:31 motd -> /etc/motd

In the `ls` long listing output, take note of the 2nd column, which represents the count of references to the same inode, which increases after creating a hard link. Some properties of hard links:

- Same permissions and modification timestamps
- Inode reference counts will increase for each hard link.
- Removal of the target file or hard link will not result in broken links, as they both physically reference the same inode.



## File Types and Permissions

File permissions are applied at 3 levels; the owner, the group and everyone else. Each can read, write and/or execute.

A sample file permission bitmap could be `-rwxrw-rw-`. The first bit `-` a dash indicates its a plain old file (there are several types, such as `l` for symlink, `d` a directory, ...). Then the owner, group and other bits.

`chmod` supports symbolic and octal variations of permissions. Some symbolic examples:

    chmod u+x file1
    chmod g-rw file1
    chmod o+wx file1
    chmod +x file1


- To navigate directory structure, requires execute permission on the directory. Execute bits could be set on directories, but not files, to allow a browsable tree, using `chmod` with the `X` (big x) modifier.
- When creating new files, the default owner and group will be that of the user (e.g. ben). `newgrp finance` will default the group to `finance`.
- Default permissions are applied with `umask`.


    groupadd finance #add group
    getent group #verify
    usermod -G finance amy #add user to group
    mkdir /home/finance #create a dir
    chown :finance /home/finance #change its group
    chmod -R o-rwx g+rw /home/finance #remove other perms and +rw group perms
    exit #logout user to reload groups


Recursively setting execute on directories only:

    chmod ugo-x -R finance #strip execute on everything
    chmod ug+X -R finance #user and group directory exec bit only


To apply the permission bits to all specify `a` (as opposed to the usual `u`, `g` and `o`):

    chmod a+r file1

### setuid setgid

The running of processes as their original owner. Impersonation if you will. Known as suid. Take for example the `/usr/bin/passwd` program:

    -rwsr-xr-x.   1 root root       27872 Feb  5  2016 passwd
       ^

Note the `s` (suid) bit. While `passwd` is owned and grouped by root, its runnable by average joe users under roots context, as if being run by the real root user. Can be set with `chmod`:

    chmod u+s file1 #set s-bit for user
    chmod 4500 file1 #set s-bit for user with 500
    chmod 2500 file1 #set s-bit for group with 500
    chmod 6444 file #set s-bit both user and group with 444


### Sticky bit

Prevents the removal of files and/or directories unless the rightful owner. To set:

    chmod +t dolphin #set sticky bit
    chmod 1777 dolphin #set sticky and 777

`+t` sets the sticky bit:

    drw-rw---T. 1 ben  finance    0 May 14 19:06 dolphin
             ^
The sticky bit in Linux is only useful when applies to directories. Files within "sticky" directories will no be deletable.


### umask (user mask)

Defines the default, user specific permission mask. For files, the default is 666 or read/write and no execute for user/group/other. For directories, the default is 777 or read/write/execute for user/group/other.

    $ umask
    0022

Breaking down each bit. The first `0` will not apply any mask to the special bits (suid/guid/sticky bit). The second `0` will apply no mask to the owner. The third `2` will mask out (think subtract)  *write* permission (2 in octal), and similarly for all other users for the fourth `2` will strip write perms.




## User and Group Management

By default prvileged users (such as root) have UID less than 200. Also their group is typically set to `wheel`, to pickup sgid (pseudo impersonation privileges).

    id -gn #users group name
    id -un #users user name


