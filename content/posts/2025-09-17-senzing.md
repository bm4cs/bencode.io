---
layout: post
draft: true
title: "Senzing Entity Resolution Primer"
slug: "senzing"
date: "2025-09-19 09:35:00+1000"
lastmod: "2025-09-19 09:35:00+1000"
comments: false
categories:
  - entityresolution
  - data
  - ER
---

- [Context](#context)
  - [Record vs Entity vs Relationship](#record-vs-entity-vs-relationship)
  - [Data Quality Issues ER Addresses](#data-quality-issues-er-addresses)
- [Senzing](#senzing)
  - [Repository](#repository)
  - [Key Senzing Attributes](#key-senzing-attributes)
  - [Resolution Concepts](#resolution-concepts)
    - [Candidates](#candidates)
    - [Features](#features)
    - [Feature Scores](#feature-scores)
    - [Match Levels](#match-levels)
    - [Resolution Rules](#resolution-rules)
- [.NET SDK](#net-sdk)
  - [Primary Interfaces](#primary-interfaces)
  - [Common Data Structures](#common-data-structures)
  - [Typical Implementation Flow](#typical-implementation-flow)
  - [Best Practices](#best-practices)
    - [Performance Optimization](#performance-optimization)
    - [Error Handling](#error-handling)
    - [Configuration Management](#configuration-management)
  - [Troubleshooting Quick Reference](#troubleshooting-quick-reference)
    - [Common Issues](#common-issues)
    - [Diagnostic Tools](#diagnostic-tools)
- [Senzing Setup](#senzing-setup)
  - [Environment](#environment)
  - [PostgreSQL](#postgresql)
  - [Provision DB schema (init-database)](#provision-db-schema-init-database)
  - [SDK Tools (senzingsdk-tools)](#sdk-tools-senzingsdk-tools)
    - [sz\_configtool](#sz_configtool)
      - [listFeatures](#listfeatures)
      - [listAttributes](#listattributes)
      - [listRules](#listrules)
      - [listFragments](#listfragments)
      - [principles](#principles)
    - [sz\_explorer](#sz_explorer)
      - [get](#get)
      - [how (tree)](#how-tree)
      - [how (summary)](#how-summary)
  - [API (senzing-api-server)](#api-senzing-api-server)
- [Load Sample Data](#load-sample-data)
- [Entity Resolutions Fundamentals](#entity-resolutions-fundamentals)
  - [Unstable Entity IDs](#unstable-entity-ids)

## Context

The process of identifying and linking records that refer to the same real-world entity across different data sources, even when the records contain variations, errors, or incomplete information.

- **Entity-Centric Learning**: A process where resolved entities are treated holistically, enabling the system to learn from every name and address variation
- **Sequence Neutrality**: The ability to reevaluate and improve prior ER decisions regardless of the order data is loaded
- **Auto-Generics Detection**: The ability to detect and handle widely used erroneous data during real-time ER
- **Disclosed Relationships**: Known connections between entities based on factual information
- **Derived Relationships**: Undisclosed or hidden connections between entities detected during ER
- **Find Path**: The ability to explore and reveal connections between distant entities in the entity graph
- **Privacy by Design (PbD)**: An engineering approach that considers privacy throughout the entire development process

### Record vs Entity vs Relationship

- **Record**: A single data entry from a source system (customer record, transaction, etc.)
- **Entity**: A resolved real-world object that may be represented by multiple records
- **Relationship**: Connections between entities (family members, business associates, etc.)

### Data Quality Issues ER Addresses

- **Duplicates**: Multiple records for the same entity
- **Variants**: Name variations (Bob/Robert, Inc/Incorporated)
- **Typos**: Misspellings and data entry errors
- **Incomplete Data**: Missing fields across records
- **Inconsistent Formats**: Different date/phone/address formats

## Senzing

Specifically I'm interested in Senzing aka `G2`, `G2` being the OG code name of what Senzing is today, which began as a 2009 IBM skunkworks project.

Senzing configuration is concerned with the following concepts:

- Data sources
- Entity types
- Features and attributes
- Resolution rules
- Thresholds

Examples of entity types:

- `PERSON`: Individuals
- `ORGANIZATION`: Companies, agencies
- `VESSEL`: Ships, aircraft
- Custom Types: Domain-specific entities

### Repository

Storage layer containing:

- **Resolved Entities**: Final entity representations
- **Records**: Original input records
- **Relationships**: Entity connections
- **Features**: Extracted and standardised data

These logical layers map to data stores:

- **Master List**: A curated collection of entities (e.g., customer list, employee database) that may contain duplicates and is used for entity resolution
- **Transaction Data**: Event-based records containing identifying information about entities, used to connect with master records and watchlists
- **Watchlist**: A collection of entities you want to avoid due to potential risks (e.g., fraudsters, sanctioned individuals)
- **Reference List**: Supplemental data used to enrich entity understanding (e.g., demographics, historical addresses)

### Key Senzing Attributes

- `DATA_SOURCE`: A required string attribute identifying the source of the record (max 25 characters)
- `RECORD_ID`: A unique identifier within a data source, strongly recommended for updates and maintenance
- `RECORD_TYPE`: Specifies the type of entity (e.g. `PERSON`, `ORGANIZATION`) to prevent inappropriate resolutions
- `NAME_TYPE`: Classifies names as `PRIMARY` or `ALIAS`, used for entity resolution

### Resolution Concepts

#### Candidates

Records that potentially match during resolution process.

#### Features

Standardised, comparable attributes extracted from raw data:

- **NAME_FULL**: Standardised full names
- **ADDR_FULL**: Standardised addresses
- **PHONE**: Standardised phone numbers
- **EMAIL**: Email addresses
- **DOB**: Date of birth
- **SSN**: Social Security Numbers

#### Feature Scores

Numerical similarity scores between features (0-100):

- **Exact Match**: 100
- **Close Match**: 80-99
- **Likely Match**: 60-79
- **Possible Match**: 40-59

#### Match Levels

Senzing's confidence levels for entity relationships:

1. **Match (Level 1)**: Very high confidence same entity
2. **Possible Match (Level 2)**: Likely same entity, review recommended
3. **Possible Relation (Level 3)**: Likely related entities
4. **Name Only Match (Level 4)**: Shared name, different entities

#### Resolution Rules

Logic determining when records should resolve:

- **Principle**: Core matching logic (exact SSN match)
- **Rule**: Specific matching combinations
- **Threshold**: Minimum scores required

## .NET SDK

### Primary Interfaces

```csharp
// Core engine interface
public interface G2Engine
{
    // Add records
    int AddRecord(string dataSourceCode, string recordId, string jsonData);

    // Get entity details
    string GetEntity(long entityId);

    // Search for entities
    string SearchByAttributes(string jsonData);

    // Get relationships
    string FindNetworkByEntityId(long entityId, int maxDegrees);
}

// Configuration management
public interface G2Config
{
    string Save();
    int Load(string configStr);
    int AddDataSource(string dataSourceCode);
}

// Diagnostic interface
public interface G2Diagnostic
{
    string GetDataSourceCounts();
    string GetEntitySizeBreakdown(int minimumEntitySize);
}
```

### Common Data Structures

```csharp
// Input record format
var recordJson = @"{
    'NAME_FULL': 'John Smith',
    'ADDR_FULL': '123 Main St, Anytown, NY 12345',
    'PHONE': '555-123-4567',
    'EMAIL': 'john.smith@email.com',
    'DOB': '1980-05-15'
}";

// Entity response structure
{
    "ENTITY_ID": 12345,
    "RECORDS": [...],
    "FEATURES": {...},
    "RELATED_ENTITIES": [...]
}
```

### Typical Implementation Flow

1. **Initialize Engine**

   ```csharp
   var engine = new G2EngineImpl();
   engine.Init("MyApp", configJson, verboseLogging);
   ```

2. **Load Configuration**

   ```csharp
   var config = new G2ConfigImpl();
   var configId = config.Create();
   engine.ReplaceConfig(configId);
   ```

3. **Add Data Sources**

   ```csharp
   config.AddDataSource("CUSTOMER_DB");
   config.AddDataSource("CRM_SYSTEM");
   ```

4. **Process Records**

   ```csharp
   engine.AddRecord("CUSTOMER_DB", "CUST001", recordJson);
   ```

5. **Query Results**
   ```csharp
   var entity = engine.GetEntity(entityId);
   var matches = engine.SearchByAttributes(searchJson);
   ```

### Best Practices

#### Performance Optimization

- Use bulk loading for large datasets
- Implement proper threading for concurrent access
- Monitor memory usage during processing
- Use streaming for large result sets

#### Error Handling

```csharp
try
{
    var result = engine.AddRecord(dataSource, recordId, jsonData);
    if (result != 0)
    {
        var error = engine.GetLastException();
        // Handle error appropriately
    }
}
catch (G2Exception ex)
{
    // Handle Senzing-specific exceptions
}
```

#### Configuration Management

- Version control configuration changes
- Test configuration in development environment
- Use staged deployments for configuration updates
- Monitor resolution quality after changes

### Troubleshooting Quick Reference

#### Common Issues

- **Poor Match Quality**: Review feature configuration and thresholds
- **Performance Issues**: Check threading, memory allocation, database tuning
- **Configuration Errors**: Validate JSON syntax and required fields
- **Memory Leaks**: Ensure proper disposal of engine instances

#### Diagnostic Tools

```csharp
// Get processing statistics
var stats = diagnostic.GetDataSourceCounts();

// Analyze entity size distribution
var breakdown = diagnostic.GetEntitySizeBreakdown(2);

// Review feature utilization
var features = engine.GetFeatureStatistics();
```

This primer covers the essential concepts and terminology you'll encounter when building your entity resolution system with Senzing's .NET SDK. Focus on understanding the resolution workflow and key configuration concepts as you begin implementation.

## Senzing Setup

### Environment

Create an `.env` next to the compose YAML:

```ini
DB_NAME=G2
DB_USER=senzing_user
DB_PASS=senzing_pass
DB_HOST=10.1.1.32
DB_PORT=5432
```

### PostgreSQL

Create a `docker-compose.yml`:

```yaml
version: "3.8"
services:
  postgres:
    image: postgres:latest
    container_name: senzing_postgres
    environment:
      - POSTGRES_DB=${DB_NAME}
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASS}
    network_mode: "host"
    ports:
      - "5432:5432"
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
      - ./pg_hba.conf:/var/lib/postgresql/data/pg_hba.conf
    restart: unless-stopped
    # command: ["postgres", "-c", "hba_file=/var/lib/postgresql/data/pg_hba.conf"]
```

Then boot it up `docker compose up`

### Provision DB schema (init-database)

```sh
export SENZING_ENGINE_CONFIGURATION_JSON='{
 "PIPELINE" : {
  "CONFIGPATH" : "/etc/opt/senzing",
  "RESOURCEPATH" : "/opt/senzing/er/resources",
  "SUPPORTPATH" : "/opt/senzing/data"
 },
 "SQL" : {
  "CONNECTION" : "postgresql://senzing_user:senzing_pass@10.1.1.32:5432:G2?sslmode=disable"
 }
}'

docker run --network=host --rm --env SENZING_ENGINE_CONFIGURATION_JSON senzing/init-database --install-senzing-er-configuration
```

Tip: Make sure that connection string uses non-standard style colon delimiters as per [docs](https://senzing.com/docs/quickstart/quickstart_docker/).

This will create the following tables in the `public` schema:

```
dsrc_record
lib_feat
obs_ent
res_ent
res_ent_okey
res_feat_ekey
res_feat_stat
res_rel_ekey
res_relate
sys_cfg
sys_codes_used
sys_eval_queue
sys_hw_check
sys_sequence
sys_status
sys_vars
```

### SDK Tools (senzingsdk-tools)

https://senzing.com/docs/quickstart/quickstart_docker/

```yaml
version: "3.8"
services:
  postgres:
    image: postgres:latest
    container_name: senzing_postgres
    environment:
      - POSTGRES_DB=${DB_NAME}
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASS}
    network_mode: "host"
    ports:
      - "5432:5432"
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
      - ./pg_hba.conf:/var/lib/postgresql/data/pg_hba.conf
    restart: unless-stopped
    command: ["postgres", "-c", "hba_file=/var/lib/postgresql/data/pg_hba.conf"]

  senzing-tools:
    image: senzing/senzingsdk-tools
    container_name: senzing_tools
    network_mode: "host"
    environment:
      SENZING_ENGINE_CONFIGURATION_JSON: |
        {
          "PIPELINE": {
            "CONFIGPATH": "/etc/opt/senzing",
            "RESOURCEPATH": "/opt/senzing/er/resources",
            "SUPPORTPATH": "/opt/senzing/data"
          },
          "SQL": {
            "CONNECTION": "postgresql://${DB_USER}:${DB_PASS}@${DB_HOST}:${DB_PORT}:${DB_NAME}?sslmode=disable"
          }
        }
    volumes:
      - ./data/senzing:/data
    depends_on:
      - postgres
    restart: unless-stopped
    command: tail -f /dev/null # keep container running
```

TTY into the senzing_tools containers:

```sh
docker exec -it senzing_tools bash
cd /opt/senzing/er/bin
```

Tools available:

- `sz_audit`: Tool for system audits and analyzing entity resolution processes
- `sz_json_analyzer`: Analyzes and validates JSON data structures within the Senzing environment
- `sz_snapshot`: Creates snapshots of the current project state for backup and version control purposes
- `sz_command`: Processes and executes various Senzing-related commands and operations
- [`sz_explorer`](https://senzing.com/docs/tutorials/eda/eda_basic_exploration/): Interactive exploratory data analysis tool for examining resolved entities and their relationships
- `sz_configtool`: Utility for managing and configuring data sources

#### sz_configtool

This utility allows you to configure a Senzing instance.

Senzing compares records within and across data sources. Records consist of features and features have attributes. For instance, the `NAME` feature has attributes such as `NAME_FIRST` and `NAME_LAST` for a person and `NAME_ORG` for an organization.

Features are standardised and expressed in various ways to create candidate keys, and when candidates are found all of their features are compared to the features of the incoming record to see how close they actually are.

Data source commands:

- `addDataSource`: to register a new data source
- `deleteDataSource`: to remove a data source created by error
- `listDataSources`: to see all the registered data sources

When you see a how or a why screen output in Senzing, you see the actual entity counts and scores of a match. The list functions below show you what those thresholds and scores are currently configured to.

Features and attribute settings:

`listFeatures`: to see all features, whether they are used for candidates, and how they are scored
`listAttributes`: to see all the attributes you can map to

Principles (rules, scores, and thresholds):

`listFunctions`: to see all the standardize, expression and comparison functions possible
`listGenericThresholds`: to see all the thresholds for when feature values go generic for candidates or scoring
`listRules`: to see all the principles in the order they are evaluated
`listFragments`: to see all the fragments of rules are configured, such as what is considered close_name

Finally, a set of rules or "principles" are applied to the feature scores of each candidate to see if the incoming record should resolve to an existing entity or become a new one. In either case, the rules are also used to create relationships between entities.

To understand more about configuring Senzing:

- [ER Processes](https://senzing.com/wp-content/uploads/Entity-Resolution-Processes-021320.pdf)
- [Principle Based ER](https://senzing.com/wp-content/uploads/Principle-Based-Entity-Resolution-092519.pdf)
- [Entity Specification](https://senzing.zendesk.com/hc/en-us/articles/231925448-Generic-Entity-Specification-JSON-CSV-Mapping)

##### listFeatures

Note the `standardize` functions, such as `PARSE_PHONE`, for normalizing data:

```
┌────┬────────────────────────────┬────────────────┬──────────┬───────────┬────────────┬────────────────────┬────────────────┬──────────────────────────┬──────────┬─────────┬
│ id │ feature                    │ class          │ behavior │ anonymize │ candidates │ standardize        │ expression     │ comparison               │ matchKey │ version │
├────┼────────────────────────────┼────────────────┼──────────┼───────────┼────────────┼────────────────────┼────────────────┼──────────────────────────┼──────────┼─────────┼
│ 1  │ NAME                       │ NAME           │ NAME     │ No        │ No         │ PARSE_NAME         │ NAME_HASHER    │ GNR_COMP                 │ Yes      │ 2       │
├────┼────────────────────────────┼────────────────┼──────────┼───────────┼────────────┼────────────────────┼────────────────┼──────────────────────────┼──────────┼─────────┼
│ 2  │ DOB                        │ BIO_DATE       │ FMES     │ No        │ Yes        │ PARSE_DOB          │                │ DOB_COMP                 │ Yes      │ 2       │
├────┼────────────────────────────┼────────────────┼──────────┼───────────┼────────────┼────────────────────┼────────────────┼──────────────────────────┼──────────┼─────────┼
│ 3  │ DOD                        │ BIO_DATE       │ FMES     │ No        │ Yes        │ PARSE_DOB          │                │ DOB_COMP                 │ Yes      │ 2       │
├────┼────────────────────────────┼────────────────┼──────────┼───────────┼────────────┼────────────────────┼────────────────┼──────────────────────────┼──────────┼─────────┼
│ 4  │ GENDER                     │ BIO_FEATURE    │ FVME     │ No        │ No         │                    │                │ EXACT_DOMAIN_COMP        │ Denial   │ 1       │
├────┼────────────────────────────┼────────────────┼──────────┼───────────┼────────────┼────────────────────┼────────────────┼──────────────────────────┼──────────┼─────────┼
│ 5  │ ADDRESS                    │ POSTAL_ADDRESS │ FF       │ No        │ No         │ PARSE_ADDR         │ ADDR_HASHER    │ ADDR_COMP                │ Yes      │ 4       │
├────┼────────────────────────────┼────────────────┼──────────┼───────────┼────────────┼────────────────────┼────────────────┼──────────────────────────┼──────────┼─────────┼
│ 6  │ PHONE                      │ PHONE          │ FF       │ No        │ No         │ PARSE_PHONE        │ PHONE_HASHER   │ PHONE_COMP               │ Yes      │ 1       │
├────┼────────────────────────────┼────────────────┼──────────┼───────────┼────────────┼────────────────────┼────────────────┼──────────────────────────┼──────────┼─────────┼
```

##### listAttributes

```
┌──────┬──────────────────────────────┬──────────────┬────────────────────────┬─────────────────┬──────────┬──────────┬──────────┐
│ id   │ attribute                    │ class        │ feature                │ element         │ required │ default  │ internal │
├──────┼──────────────────────────────┼──────────────┼────────────────────────┼─────────────────┼──────────┼──────────┼──────────┤
│ 1001 │ DATA_SOURCE                  │ OBSERVATION  │ None                   │ None            │ Yes      │ None     │ No       │
├──────┼──────────────────────────────┼──────────────┼────────────────────────┼─────────────────┼──────────┼──────────┼──────────┤
│ 1003 │ RECORD_ID                    │ OBSERVATION  │ None                   │ None            │ No       │ None     │ No       │
├──────┼──────────────────────────────┼──────────────┼────────────────────────┼─────────────────┼──────────┼──────────┼──────────┤
│ 1007 │ DSRC_ACTION                  │ OBSERVATION  │ None                   │ None            │ Yes      │ None     │ Yes      │
├──────┼──────────────────────────────┼──────────────┼────────────────────────┼─────────────────┼──────────┼──────────┼──────────┤
│ 1101 │ NAME_TYPE                    │ NAME         │ NAME                   │ USAGE_TYPE      │ No       │ None     │ No       │
├──────┼──────────────────────────────┼──────────────┼────────────────────────┼─────────────────┼──────────┼──────────┼──────────┤
```

##### listRules

```
┌─────┬───────────────────────────┬─────────┬────────┬──────────┬─────────────────────┬───────────────┬──────┐
│ id  │ rule                      │ resolve │ relate │ rtype_id │ fragment            │ disqualifier  │ tier │
├─────┼───────────────────────────┼─────────┼────────┼──────────┼─────────────────────┼───────────────┼──────┤
│ 100 │ SAME_A1                   │ Yes     │ No     │ 1        │ SAME_A1             │ None          │ 10   │
├─────┼───────────────────────────┼─────────┼────────┼──────────┼─────────────────────┼───────────────┼──────┤
│ 108 │ SF1_SNAME_CFF_CSTAB       │ Yes     │ No     │ 1        │ SF1_SNAME_CFF_CSTAB │ DIFF_EXCL     │ 18   │
├─────┼───────────────────────────┼─────────┼────────┼──────────┼─────────────────────┼───────────────┼──────┤
│ 110 │ SF1_PNAME_CFF_CSTAB       │ Yes     │ No     │ 1        │ SF1_PNAME_CFF_CSTAB │ DIFF_EXCL     │ 20   │
├─────┼───────────────────────────┼─────────┼────────┼──────────┼─────────────────────┼───────────────┼──────┤
│ 111 │ SF1_SNAME_CFF_CSTAB_DEXCL │ Yes     │ No     │ 1        │ SF1_SNAME_CFF_CSTAB │ DIFF_GEN_A1ES │ 20   │
├─────┼───────────────────────────┼─────────┼────────┼──────────┼─────────────────────┼───────────────┼──────┤
│ 112 │ SF1_PNAME_CFF_OLD         │ Yes     │ No     │ 1        │ DISABLE             │               │ 20   │
├─────┼───────────────────────────┼─────────┼────────┼──────────┼─────────────────────┼───────────────┼──────┤
│ 120 │ SF1_PNAME_CSTAB           │ Yes     │ No     │ 1        │ SF1_PNAME_CSTAB     │ DIFF_EXCL     │ 20   │
├─────┼───────────────────────────┼─────────┼────────┼──────────┼─────────────────────┼───────────────┼──────┤
```

##### listFragments

Rules are combinations of fragments like `close_name` or `same_name`

```
┌─────┬─────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────┬──────────────┐
│ id  │ fragment            │ source                                                                                                  │ depends      │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 11  │ SAME_NAME           │ ./FRAGMENT[./GNR_SAME_NAME>0]                                                                           │ 301          │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 12  │ CLOSE_NAME          │ ./FRAGMENT[./GNR_CLOSE_NAME>0]                                                                          │ 302          │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 13  │ LIKELY_NAME         │ ./FRAGMENT[./GNR_LIKELY_NAME>0]                                                                         │ 303          │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 14  │ PART_NAME           │ ./FRAGMENT[./GNR_PART_NAME>0]                                                                           │ 304          │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 15  │ SUR_NAME            │ ./FRAGMENT[./GNR_SUR_NAME>0]                                                                            │ 305          │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 16  │ DIFF_NAME           │ ./SUMMARY/BEHAVIOR/NAME[sum(./UNLIKELY | ./NO_CHANCE) > 0]                                              │ None         │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 17  │ NO_NAME             │ ./SUMMARY/BEHAVIOR/NAME[sum(./SAME | ./CLOSE | ./LIKELY | ./PLAUSIBLE | ./UNLIKELY | ./NO_CHANCE) = 0]  │ None         │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 18  │ ORG_NAME            │ ./FRAGMENT[./GNR_ORG_NAME>0]                                                                            │ 306          │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ 19  │ PART_NO_NAME        │ ./FRAGMENT[./PART_NAME>0 or ./NO_NAME>0]                                                                │ 14,17        │
├─────┼─────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────┤
```

##### principles

Before the principles are applied, the features and expressions created for an incoming record are used to find candidates. An example of an expression is name and DOB and there is an expression call on the feature "name" to automatically create it if both a name and DOB are present on the incoming record. Features and expressions used for candidates are also referred to as candidate builders or candidate keys.

- `listFeatures`: to see what features are used for candidates
- `setFeature`: to toggle whether or not a feature is used for candidates
- `listExpressionCalls`: to see what expressions are currently being created
- `addToNamehash`: to add an element from another feature to the list of composite name keys
- `addExpressionCall`: to add a new expression call, aka candidate key
- `listGenericThresholds`: to see when candidate keys will become generic and are no longer used to find candidates
- `setGenericThreshold`: to change when features with certain behaviors become generic

Once the candidate matches have been found, scoring and rule evaluation takes place. Scores are rolled up by behavior. For instance, both addresses and phones have the behavior `FF` (Frequency Few). If they both score above their scoring functions close threshold, there would be two `CLOSE_FF`s (a fragment) which can be used in a rule such as `NAME+CLOSE_FF`.

Commands that help with configuring principles (rules) and scoring:

- `listRules`: these are the principles that are applied top down
- `listFragments`: rules are combinations of fragments like close_name or same_name
- `listFunctions`: the comparison functions show you what is considered same, close, likely, etc.
- `setRule`: to change whether an existing rule resolves or relates

#### sz_explorer

Adhoc entity commands:

- `search`: search for entities by name and/or other attributes.
- `get`: get an entity by entity ID or record_id.
- `compare`: place two or more entities side by side for easier comparison.
- `how`: get a step by step replay of how an entity came together.
- `why`: see why entities or records either did or did not resolve.
- `tree`: see a tree view of an entity's relationships through 1 or 2 degrees.
- `export`: export the json records for an entity for debugging or correcting and reloading.

Snapshot reports (requires a json file generated by `sz_snapshot`):

- `data_source_summary`: shows how many duplicates were detected within each data source, as well as the possible matches and relationships that were derived. For example, how many duplicate customers there are, and are any of them related to each other.
- `cross_source_summary`: shows how many matches were made across data sources. For example, how many employees are related to customers.
- `entity_source_summary`: shows the number of entities by the set of data sources they can be found in. For example, how many entities are only in one data source, how many are only in these two data sources, etc.
- `entity_size_breakdown`: shows how many entities of what size were created. For instance, some entities are singletons, some might have connected 2 records, some 3, etc. This report is primarily used to ensure there are no instances of over matching. For instance, it’s ok for an entity to have hundreds of records as long as there are not too many different names, addresses, identifiers, etc.
- `principles_used`: shows what principles and match_keys are firing across all data sources. For example, how many name and address matches, how many address only, etc.

Audit report (requires a json file generated by `sz_audit`):

- `audit_summary`: shows the precision, recall and F1 scores with the ability to browse the entities that were split or merged.

Other commands:

- `quick_look`: show the number of records in the repository by data source without a snapshot.
- `load`: load a snapshot or audit report json file.
- `score`: show the scores of any two names, addresses, identifiers, or combination thereof.
- `set`: various settings affecting how entities are displayed.
- `show_last_call`: shows the last request and response message sent to the Senzing SDK



##### get

```
(szeda) get CUSTOMERS 1070

Entity summary for entity 51: Jie Wang
┼───────────┼────────────────────────────────────────┼─────────────────┼
│ Sources   │ Features                               │ Additional Data │
┼───────────┼────────────────────────────────────────┼─────────────────┼
│ CUSTOMERS │ NAME: Jie Wang (PRIMARY)               │ AMOUNT: 100     │
│ 1069      │ NAME: 王杰 (NATIVE)                    │ AMOUNT: 200     │
│ 1070      │ DOB: 9/14/93                           │ DATE: 1/26/18   │
│           │ GENDER: Male                           │ DATE: 1/27/18   │
│           │ GENDER: M                              │ STATUS: Active  │
│           │ ADDRESS: 12 Constitution Street (HOME) │                 │
│           │ NATIONAL_ID: 832721 Hong Kong          │                 │
│           │ NATIONAL_ID: 832721                    │                 │
│           │ RECORD_TYPE: PERSON                    │                 │
┼───────────┼────────────────────────────────────────┼─────────────────┼
│ REFERENCE │ NAME: Wang Jie (PRIMARY)               │ CATEGORY: Owner │
│ 2013      │ DOB: 1993-09-14                        │ STATUS: Current │
│           │ RECORD_TYPE: PERSON                    │                 │
│           │ REL_POINTER: 2011 (OWNS 60%)           │                 │
┼───────────┼────────────────────────────────────────┼─────────────────┼
└── Disclosed relation (1)
    └── --> OWNS 60% (1)
        └── 97: Hajah Mamunah Jln Pisang CUSTOMERS (1) | REFERENCE (1) +REL_POINTER(OWNS 60%:)
```

##### how (tree)

```
(szeda) how 51

How decision tree for 51: Jie Wang

V51-S2 final entity
├── Step 2: Add record to virtual entity on NAME+DOB  Principle 180: SNAME_SSTAB to create V51-S2
│   ┌──────────────┬─────────────────┬────────┬──────────────────────┐
│   │ VIRTUAL_ID   │ V100002         │ SCORES │ V51-S1               │
│   ├──────────────┼─────────────────┼────────┼──────────────────────┤
│   │ DATA_SOURCES │ REFERENCE: 2013 │        │ CUSTOMERS: 2 records │
│   │ NAME         │ 王杰            │  100   │ Wang Jie             │
│   │ DOB          │ 9/14/93         │  100   │ 1993-09-14           │
│   │ RECORD_TYPE  │ PERSON          │  100   │ PERSON               │
│   └──────────────┴─────────────────┴────────┴──────────────────────┘
│
└── Step 1: Create virtual entity on NAME+DOB+ADDRESS+NATIONAL_ID  Principle 131: CF1_PNAME_CFF_CSTAB to create V51-S1
    ┌──────────────┬────────────────────────┬────────┬────────────────────────┐
    │ VIRTUAL_ID   │ V51                    │ SCORES │ V54                    │
    ├──────────────┼────────────────────────┼────────┼────────────────────────┤
    │ DATA_SOURCES │ CUSTOMERS: 1070        │        │ CUSTOMERS: 1069        │
    │ NAME         │ Jie Wang               │   95   │ 王杰                   │
    │ DOB          │ 9/14/93                │  100   │ 9/14/93                │
    │ GENDER       │ Male                   │  100   │ M                      │
    │ ADDRESS      │ 12 Constitution Street │   85   │ 12 Constitution Street │
    │ NATIONAL_ID  │ 832721 Hong Kong       │   95   │ 832721                 │
    │ RECORD_TYPE  │ PERSON                 │  100   │ PERSON                 │
    └──────────────┴────────────────────────┴────────┴────────────────────────┘
```

##### how (summary)


```
How summary for 51: Jie Wang
├── RESOLUTION SUMMARY
│   ├── Resolution steps (2)
│   │   ├── Create virtual entity (1)
│   │   └── Add record to virtual entity (1)
│   └── Principles used (2)
│       ├── Principle 131: CF1_PNAME_CFF_CSTAB (1)
│       │   └── NAME+DOB+ADDRESS+NATIONAL_ID (1)
│       └── Principle 180: SNAME_SSTAB (1)
│           └── NAME+DOB (1)
└── ENTITY SUMMARY
    ├── Total record count (3)
    ├── Total feature count (12)
    ├── NAME (3)
    │   ├── 517: 王杰 [1] (1)
    │   ├── 505: Jie Wang [1] (1)
    │   └── 100004: Wang Jie [1] (1)
    ├── DOB (2)
    │   ├── 506: 9/14/93 [1] (2)
    │   └── 100005: 1993-09-14 [1] (1)
    ├── GENDER (2)
    │   ├── 318: M [100] (1)
    │   └── 489: Male [100] (1)
    ├── ADDRESS (1)
    │   └── 507: 12 Constitution Street [1] (2)
    ├── NATIONAL_ID (2)
    │   ├── 518: 832721 [#1] (1)
    │   └── 508: 832721 Hong Kong [1] (1)
    ├── RECORD_TYPE (1)
    │   └── 7: PERSON [100] (3)
    └── REL_POINTER (1)
        └── 100003: 2011 [2] (1)
```


### API (senzing-api-server)

```yaml
version: "3.8"
services:
  postgres:
    image: postgres:latest
    container_name: senzing_postgres
    environment:
      - POSTGRES_DB=${DB_NAME}
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASS}
    network_mode: "host"
    ports:
      - "${DB_PORT}:${DB_PORT}"
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
      - ./pg_hba.conf:/var/lib/postgresql/data/pg_hba.conf
    restart: unless-stopped
    # command: ["postgres", "-c", "hba_file=/var/lib/postgresql/data/pg_hba.conf"]

  senzing-api-server:
    environment:
      SENZING_API_SERVER_ALLOWED_ORIGINS: '*'
      SENZING_API_SERVER_ENABLE_ADMIN: 'true'
      SENZING_ENGINE_CONFIGURATION_JSON: >-
        {
          "PIPELINE": {
            "CONFIGPATH": "/etc/opt/senzing",
            "LICENSESTRINGBASE64": "${SENZING_LICENSE_BASE64_ENCODED}",
            "RESOURCEPATH": "/opt/senzing/g2/resources",
            "SUPPORTPATH": "/opt/senzing/data"
          },
          "SQL": {
            "BACKEND": "SQL",
            "CONNECTION": "postgresql://${DB_USER}:${DB_PASS}@${DB_HOST}:${DB_PORT}:${DB_NAME}?sslmode=disable"
          }
        }
    image: senzing/senzing-api-server:${SENZING_DOCKER_IMAGE_VERSION_SENZING_API_SERVER:-latest}
    networks:
      - senzing
    ports:
      - 8250:8250
    environment:
      # Database connection parameters
      - DATABASE_PROTOCOL=postgresql
      - DATABASE_USERNAME=${DB_USER}
      - DATABASE_PASSWORD=${DB_PASS}
      - DATABASE_HOST=${DB_HOST}
      - DATABASE_PORT=${DB_PORT}
      - DATABASE_DATABASE=${DB_NAME}
      - SENZING_DATABASE_URL="${DATABASE_PROTOCOL}://${DATABASE_USERNAME}:${DATABASE_PASSWORD}@${DATABASE_HOST}:${DATABASE_PORT}/${DATABASE_NAME}?sslmode=disable"
      - SENZING_API_SERVER_BIND_ADDR=all
      - SENZING_API_SERVER_PORT=8250
      - SENZING_API_SERVER_SECURE_PORT=8263
      - SENZING_API_SERVER_CONCURRENCY=10
      - SENZING_API_SERVER_ALLOWED_ORIGINS=*
      - SENZING_API_SERVER_KEY_STORE=/certs/server-store.p12
      - SENZING_API_SERVER_KEY_STORE_PASSWORD=your_password
```

## Load Sample Data

Setup data sources with `senzing/senzingsdk-tools` container:

1. `sz_configtool`
2. `addDataSource CUSTOMERS`
3. `addDataSource REFERENCE`
4. `addDataSource WATCHLIST`
5. `save`

Ingest data with `senzing/sz-file-loader` container:

1. `docker run -it --rm -u $UID -v ${PWD}/data/senzing/data/:/data --env SENZING_ENGINE_CONFIGURATION_JSON senzing/sz-file-loader -f /data/customers.jsonl`
2. `docker run -it --rm -u $UID -v ${PWD}/data/senzing/data/:/data --env SENZING_ENGINE_CONFIGURATION_JSON senzing/sz-file-loader -f /data/reference.jsonl`
3. `docker run -it --rm -u $UID -v ${PWD}/data/senzing/data/:/data --env SENZING_ENGINE_CONFIGURATION_JSON senzing/sz-file-loader -f /data/watchlist.jsonl`

Explore with `sz_explorer` in the `senzing/senzingsdk-tools` container.



## Entity Resolutions Fundamentals

<https://senzing.zendesk.com/hc/en-us/articles/4415858978067-How-does-an-Entity-ID-behave>

### Unstable Entity IDs


