## Run up PostgreSQL

Create two configs.

`pg_hba.conf`:

```plaintext
# TYPE  DATABASE        USER            ADDRESS                 METHOD
local   all             all                                     scram-sha-256
host    all             all             0.0.0.0/0               scram-sha-256
host    all             all             ::0/0                   scram-sha-256
host    all             all             127.0.0.1/32            scram-sha-256
host    all             all             ::1/128                 scram-sha-256
```

`docker-compose.yml`:

```yaml
version: "3.8"
services:
  postgres:
    image: postgres:latest
    container_name: senzing_postgres
    environment:
      - POSTGRES_DB=senzing_db
      - POSTGRES_USER=senzing_user
      - POSTGRES_PASSWORD=senzing_pass
    network_mode: "host"
    ports:
      - "5432:5432"
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
      - ./pg_hba.conf:/var/lib/postgresql/data/pg_hba.conf
    restart: unless-stopped
    command: ["postgres", "-c", "hba_file=/var/lib/postgresql/data/pg_hba.conf"]

  # senzing_init:
  #   image: senzing/init-database
  #   container_name: senzing_init
  #   environment:
  #     SENZING_ENGINE_CONFIGURATION_JSON: |
  #       {
  #         "PIPELINE": {
  #           "CONFIGPATH": "/etc/opt/senzing",
  #           "RESOURCEPATH": "/opt/senzing/er/resources",
  #           "SUPPORTPATH": "/opt/senzing/data"
  #         },
  #         "SQL": {
  #           "CONNECTION": "postgresql://senzing_user:senzing_pass@senzing_postgres:5432/senzing_db"
  #         }
  #       }
  #   volumes:
  #     - ./data/senzing:/data
  #   depends_on:
  #     - postgres
  #   restart: unless-stopped
  #   command: --help && tail -f /dev/null  # keep container running

  senzing:
    image: senzing/senzingsdk-tools
    container_name: senzing_tools
    network_mode: "host"
    environment:
      SENZING_ENGINE_CONFIGURATION_JSON: |
        {
          "PIPELINE": {
            "CONFIGPATH": "/etc/opt/senzing",
            "RESOURCEPATH": "/opt/senzing/er/resources",
            "SUPPORTPATH": "/opt/senzing/data"
          },
          "SQL": {
            "CONNECTION": "postgresql://senzing_user:senzing_pass@172.21.32.110:5432:senzing_db?sslmode=disable"
          }
        }
    volumes:
      - ./data/senzing:/data
    depends_on:
      - postgres
    restart: unless-stopped
    command: tail -f /dev/null # keep container running
```

## DB setup

```sh
SENZING_ENGINE_CONFIGURATION_JSON='{
 "PIPELINE" : {
  "CONFIGPATH" : "/etc/opt/senzing",
  "RESOURCEPATH" : "/opt/senzing/er/resources",
  "SUPPORTPATH" : "/opt/senzing/data"
 },
 "SQL" : {
  "CONNECTION" : "postgresql://senzing_user:senzing_pass@172.21.32.110:5432:senzing_db?sslmode=disable"
 }
}'

docker run --network=host --rm --env SENZING_ENGINE_CONFIGURATION_JSON senzing/init-database --install-senzing-er-configuration
```

Tip: Make sure that connection string uses non-standard style colon delimiters as per [docs](https://senzing.com/docs/quickstart/quickstart_docker/).

This will create the following tables in the `public` schema:

```
dsrc_record
lib_feat
obs_ent
res_ent
res_ent_okey
res_feat_ekey
res_feat_stat
res_rel_ekey
res_relate
sys_cfg
sys_codes_used
sys_eval_queue
sys_hw_check
sys_sequence
sys_status
sys_vars
```

## Running

https://senzing.com/docs/quickstart/quickstart_docker/

```yaml
version: "3.8"
services:
  postgres:
    image: postgres:latest
    container_name: senzing_postgres
    environment:
      - POSTGRES_DB=senzing_db
      - POSTGRES_USER=senzing_user
      - POSTGRES_PASSWORD=senzing_pass
    network_mode: "host"
    ports:
      - "5432:5432"
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
      - ./pg_hba.conf:/var/lib/postgresql/data/pg_hba.conf
    restart: unless-stopped
    command: ["postgres", "-c", "hba_file=/var/lib/postgresql/data/pg_hba.conf"]

  # senzing_init:
  #   image: senzing/init-database
  #   container_name: senzing_init
  #   environment:
  #     SENZING_ENGINE_CONFIGURATION_JSON: |
  #       {
  #         "PIPELINE": {
  #           "CONFIGPATH": "/etc/opt/senzing",
  #           "RESOURCEPATH": "/opt/senzing/er/resources",
  #           "SUPPORTPATH": "/opt/senzing/data"
  #         },
  #         "SQL": {
  #           "CONNECTION": "postgresql://senzing_user:senzing_pass@senzing_postgres:5432/senzing_db"
  #         }
  #       }
  #   volumes:
  #     - ./data/senzing:/data
  #   depends_on:
  #     - postgres
  #   restart: unless-stopped
  #   command: --help && tail -f /dev/null  # keep container running

  senzing:
    image: senzing/senzingsdk-tools
    container_name: senzing_tools
    network_mode: "host"
    environment:
      SENZING_ENGINE_CONFIGURATION_JSON: |
        {
          "PIPELINE": {
            "CONFIGPATH": "/etc/opt/senzing",
            "RESOURCEPATH": "/opt/senzing/er/resources",
            "SUPPORTPATH": "/opt/senzing/data"
          },
          "SQL": {
            "CONNECTION": "postgresql://senzing_user:senzing_pass@172.21.32.110:5432:senzing_db?sslmode=disable"
          }
        }
    volumes:
      - ./data/senzing:/data
    depends_on:
      - postgres
    restart: unless-stopped
    command: tail -f /dev/null # keep container running
```

TTY into the senzing_tools containers:

```sh
docker exec -it senzing_tools bash
cd /opt/senzing/er/bin
```

Tools available:

```
_sz_database.py
_tool_helpers.py
sz_audit
sz_json_analyzer
sz_snapshot
sz_command
sz_explorer
sz_configtool
```
