---
layout: post
draft: true
title: "Go"
slug: "go"
date: "2019-10-05 19:02:44"
lastmod: "2020-08-18 19:02:47"
comments: false
categories:
  - dev
tags:
  - golang
---

G'day. The [`go`](https://golang.org/cmd/go/) tool is a CLI for managing Go source.

- [GOPATH](#gopath)
- [Run, build and install](#run-build-and-install)
- [Dependencies](#dependencies)
- [Formatting](#formatting)
- [Documentation](#documentation)
- [Structuring a source tree](#structuring-a-source-tree)
- [The lang](#the-lang)
  - [Variables](#variables)
  - [Control structures (if, switch and for)](#control-structures-if-switch-and-for)
    - [if](#if)
    - [switch](#switch)
- [for](#for)
- [Libraries](#libraries)
  - [Middleware](#middleware)
  - [Web](#web)

[Effective Go](https://golang.org/doc/effective_go.html) guides on writing idiomatic go code.

# GOPATH

It is convention for all Go code to be hosted in a single workspace, and `GOPATH` points to the root of this workspace.

A Go workspace contains one or more project repositories. Each repository is independently version controlled.

Inject this into `~/.profile` and include the `$GOPATH/bin` on `PATH`:

    export GOPATH=$HOME/go
    export PATH="$PATH:$GOPATH/bin"

Using `go env` validate `GOPATH`:

    cd `go env GOPATH`

# Run, build and install

Source is placed within the `src` dir within `$GOPATH` like `$GOPATH/src/github.com/bm4cs/cool-app/main.go`

To just run a program, without building a binary output:

    $ go run main.go
    hello world

To build a statically linked binary output:

    $ go build
    $ file demo
    demo: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked

Cross compiling is available too:

    $ GOOS=windows go build
    $ file demo.exe
    demo.exe: PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows

The binary can be written to `$GOPATH/bin` (or `$GOPATH/pkg` for libraries) which is normally on the `PATH`:

    $ go install
    $ ls $GOPATH/bin | grep demo
    demo

# Dependencies

TODO: modules

    $ go get github.com/golang/example/hello
    $ $GOPATH/bin/hello
    Hello, Go examples!

# Formatting

Format a file to `stdout`:

    $ gofmt main.go

Diff:

    $ gofmt -d main.go

Update (write) the original source file:

    $ gofmt -w main.go

# Documentation

Local CLI help:

    $ go doc fmt Printf

    func Printf(format string, a ...interface{}) (n int, err error)
    Printf formats according to a format specifier and writes to standard
    output. It returns the number of bytes written and any write error
    encountered.

Local documentation HTTP server:

    $ godoc -http :7070

# Structuring a source tree

[project-layout](https://github.com/golang-standards/project-layout) curates common conventions followed by the community.

Check out [go-structure-examples](https://github.com/katzien/go-structure-examples) for flat, layered, modular and DDD based layouts.

# The lang

## Variables

    var a int //set to 0
    var b int = 10
    var d, e, f bool
    var (
        g int
        h string
        i int = 1234
        j, k, l bool
    )

Inside a func can use _short variable declaration_ (a declaration and assignment in one step):

    m := 1
    n, o := 2, 3

Assignments:

    e, f = f, e
    a := 11
    a, p := 100, 200

The blank identifer (for ignoring outputs):

    a, _ := f()
    g(a)

## Control structures (if, switch and for)

### if

Go uniquely supports an _initialisation statement_, within the if statement:

    if err := f(x); err != nil {
        return err
    }

Ternary operators are not supported, due to readability.

### switch

Case statements do not fallthrough in Go.

Supports vanilla style:

    var model string
    //...
    switch model {
        case "dell":
            // Do something
        case "acer":
            // Do something else
        case "compaq":
            // Do something different
        default:
            // Do nothing
    }

However, unlike many langs go supports another switch-expressionless form:

    var velocity int
    //...
    switch {
        case velocity == 0 || velocity == 1:
            //...
        case velocity >= 10:
            //...
        case f(velocity) >= f(100):
            //...
    }

If fallthrough is required there are a couple of options:

    case velocity >= 10:
        //...
        fallthrough

Or pile up the case statements with multiple expressions:

    switch motion {
        case "walk", "run":

# for

The `for` keyword covers off all loop types in Go. There is no support for `while`, `until` or similar keywords.

- For loop `for i=0; i<10; i++`
- While loop `for i<10`
- Infinite loop `for`
- Enumerable iteration `for i, v := range s`

# Libraries

## Middleware

- [negroni](https://github.com/urfave/negroni) idiomatic HTTP middleware
- [alice](https://github.com/justinas/alice) painless middleware chaining

## Web

- [gin](https://github.com/gin-gonic/gin) HTTP web framework
- [go-jose](https://github.com/square/go-jose) implements the Javascript Object Signing and Encryption set of standards JWE, JWS and JWT (JSON Web Encryption, JSON Web Signature and JSON Web Token)
- [gorilla](https://www.gorillatoolkit.org/) a general purpose web toolkit that solves doing context, routing, RPC over HTTP, strong typing forms to structs, secure cookies, session and websockets.
